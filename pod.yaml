volumes:
  - name: tmp
emptyDir: {}
containers:
  # name of the container – just needs to be unique within the pod.
- name: "{{ component }}"
  # automatically expands to docker.dev.s-cloud.net/<name>:<version>
  image: "{{ image }}"
  # no quotes – `cmd` is JSON-valued. Expands to
  # `./<component> --config=<env>` to work well with
  # `gen-wrapper-script` and `add-config`.  If this is not suitable, specify
  # the command and arguments as a YAML/JSON array.
  # The `.enc` ending is handled automatically by the script generated by
  # gen-wrapper-script at start time.
  # command: 
  # - "python main.py"
  command: ["python"] 
  args: ["main.py"]
  ports:
  - name: http
    containerPort: 5001
  resources:
    requests:
      memory: 250Mi
      cpu: 0.25
    limits:
      memory: 500Mi
  readinessProbe:
    httpGet:
      path: /
      port: 5001
    initialDelaySeconds: 1
    timeoutSeconds: 300
    periodSeconds: 300
  livenessProbe:
    httpGet:
      path: /
      port: 5001
    initialDelaySeconds: 300
    timeoutSeconds: 300
    periodSeconds: 300
  volumeMounts:
  - mountPath: /tmp
    name: tmp

- name: "redis"
  image: "redis"
  ports:
  - name: redis
    containerPort: 6379
  volumeMounts:
    - mountPath: /tmp
      name: tmp

- name: "celery"
  image: "{{ image }}"
  command: ["celery"] 
  args: ["worker", "--app=main.celery", "--loglevel=info"]
  volumeMounts:
    - mountPath: /tmp
      name: tmp
